<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Crystal Docs 1.18.2">
<meta name="crystal_docs.project_version" content="">
<meta name="crystal_docs.project_name" content="measure">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="measure">
  <title>measure </title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill="currentColor" fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<input type="checkbox" id="sidebar-btn">
<label for="sidebar-btn" id="sidebar-btn-label">
  <svg class="open" xmlns="http://www.w3.org/2000/svg" height="2em" width="2em" viewBox="0 0 512 512"><title>Open Sidebar</title><path fill="currentColor" d="M80 96v64h352V96H80zm0 112v64h352v-64H80zm0 112v64h352v-64H80z"></path></svg>
  <svg class="close" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 512 512"><title>Close Sidebar</title><path fill="currentColor" d="m118.6 73.4-45.2 45.2L210.7 256 73.4 393.4l45.2 45.2L256 301.3l137.4 137.3 45.2-45.2L301.3 256l137.3-137.4-45.2-45.2L256 210.7Z"></path></svg>
</label>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          measure
        </a>
      </h1>

      <span class="project-version">
        
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="measure/Measure" data-name="measure">
      <a href="Measure.html">Measure</a>
      
        <ul>
  
  <li class="parent " data-id="measure/Measure/Area" data-name="measure::area">
      <a href="Measure/Area.html">Area</a>
      
        <ul>
  
  <li class=" " data-id="measure/Measure/Area/Unit" data-name="measure::area::unit">
      <a href="Measure/Area/Unit.html">Unit</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="measure/Measure/Data" data-name="measure::data">
      <a href="Measure/Data.html">Data</a>
      
        <ul>
  
  <li class=" " data-id="measure/Measure/Data/Unit" data-name="measure::data::unit">
      <a href="Measure/Data/Unit.html">Unit</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="measure/Measure/Length" data-name="measure::length">
      <a href="Measure/Length.html">Length</a>
      
        <ul>
  
  <li class=" " data-id="measure/Measure/Length/Unit" data-name="measure::length::unit">
      <a href="Measure/Length/Unit.html">Unit</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="measure/Measure/Volume" data-name="measure::volume">
      <a href="Measure/Volume.html">Volume</a>
      
        <ul>
  
  <li class=" " data-id="measure/Measure/Volume/Unit" data-name="measure::volume::unit">
      <a href="Measure/Volume/Unit.html">Unit</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="measure/Measure/Weight" data-name="measure::weight">
      <a href="Measure/Weight.html">Weight</a>
      
        <ul>
  
  <li class=" " data-id="measure/Measure/Weight/Unit" data-name="measure::weight::unit">
      <a href="Measure/Weight/Unit.html">Unit</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="measure/Number" data-name="number">
      <a href="Number.html">Number</a>
      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="measure" class="anchor" href="#measure">  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Measure</h1>
<p>This shard lets you measure, compare, and convert values in different units of measure.</p>
<p>For example, you can do things like:</p>
<ul>
<li>Compare a weight in ounces to one in grams</li>
<li>Convert a length in miles to one in kilometers</li>
</ul>
<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>
<ol>
<li>
<p>Add the dependency to your <code>shard.yml</code>:</p>
<pre><code class="language-yaml">dependencies:
  measure:
    github: jgaskins/measure</code></pre>
</li>
<li>
<p>Run <code>shards install</code></p>
</li>
</ol>
<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>
<p><a href="https://jgaskins.dev/measure">API reference</a></p>
<h3><a id="length" class="anchor" href="#length">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Length</h3>
<p>You measure lengths with <code><a href="Measure/Length.html">Measure::Length</a></code>. You can either instantiate it with the constructor or the shorthand methods on <code><a href="Number.html">Number</a></code>:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;measure/length&quot;</span>

<span class="c"># Both of these expressions are equivalent:</span>
<span class="t">Measure</span><span class="t">::</span><span class="t">Length</span>.new(<span class="n">50</span>, <span class="n">:miles</span>)
<span class="n">50</span>.miles</code></pre>
<p>You can also convert measurements to other units:</p>
<pre><code class="language-crystal"><span class="n">50</span>.miles.to(<span class="n">:km</span>)
<span class="c"># =&gt; Measure::Length(@magnitude=80.46719742504969, @unit=Measure::Length::Unit::Kilometer)</span>
<span class="n">10</span>.miles.to(<span class="n">:feet</span>)
<span class="c"># =&gt; Measure::Length(@magnitude=52800.0, @unit=Measure::Length::Unit::Foot)</span>
<span class="n">1</span>.foot.to(<span class="n">:cm</span>)
<span class="c"># =&gt; Measure::Length(@magnitude=30.47999902464003, @unit=Measure::Length::Unit::Centimeter)</span>
<span class="n">6</span>.feet.to(<span class="n">:inches</span>)
<span class="c"># =&gt; Measure::Length(@magnitude=72.0, @unit=Measure::Length::Unit::Inch)</span></code></pre>
<h2><a id="area-and-volume" class="anchor" href="#area-and-volume">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Area and Volume</h2>
<p>You can even multiply two instances of a <code><a href="Measure/Length.html">Measure::Length</a></code> to get a <code><a href="Measure/Area.html">Measure::Area</a></code>:</p>
<pre><code class="language-crystal"><span class="n">3</span>.feet <span class="o">*</span> <span class="n">3</span>.feet <span class="c"># =&gt; Measure::Area(@magnitude=9.0, @unit=Measure::Area::Unit::SquareFoot)</span></code></pre>
<p>And then multiply that to get a <code><a href="Measure/Volume.html">Measure::Volume</a></code>:</p>
<pre><code class="language-crystal"><span class="n">3</span>.feet <span class="o">*</span> <span class="n">3</span>.feet <span class="o">*</span> <span class="n">3</span>.feet <span class="c"># =&gt; Measure::Volume(@magnitude=27.0, @unit=Measure::Volume::Unit::CubicFoot)</span></code></pre>
<p>The full list of length units are available <a href="https://jgaskins.dev/measure/Measure/Length/Unit.html">here</a>.</p>
<h3><a id="weight" class="anchor" href="#weight">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Weight</h3>
<p>Similar to <code><a href="Measure/Length.html">Measure::Length</a></code> for length/distance measurements, we measure weights with <code><a href="Measure/Weight.html">Measure::Weight</a></code>:</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;measure/weight&quot;</span>

<span class="c"># Both of these expressions are equivalent:</span>
<span class="t">Measure</span><span class="t">::</span><span class="t">Weight</span>.new(<span class="n">50</span>, <span class="n">:pounds</span>)
<span class="n">50</span>.pounds</code></pre>
<p>It also supports conversions:</p>
<pre><code class="language-crystal"><span class="n">50000</span>.grams.to(<span class="n">:pounds</span>)
<span class="c"># =&gt; Measure::Weight(@magnitude=110.231, @unit=Measure::Weight::Unit::Pound)</span>
<span class="n">50000</span>.grams.to(<span class="n">:kilograms</span>)
<span class="c"># =&gt; Measure::Weight(@magnitude=50.0, @unit=Measure::Weight::Unit::Kilogram)</span>
<span class="n">50</span>.grams.to(<span class="n">:ounces</span>)
<span class="c"># =&gt; Measure::Weight(@magnitude=1.763696, @unit=Measure::Weight::Unit::Ounce)</span></code></pre>
<h2><a id="precision" class="anchor" href="#precision">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Precision</h2>
<p>It's important to note that this shard stores the magnitude of the measurement as a <code>Float64</code>. This means it is limited to the precision 64-bit IEEE754 floating-point numbers.</p>
<h3><a id="why-float64-when-big-decimal-is-right-there" class="anchor" href="#why-float64-when-big-decimal-is-right-there">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Why <a href="https://crystal-lang.org/api/1.16.3/Float64.html"><code>Float64</code></a> when <a href="https://crystal-lang.org/api/1.16.3/BigDecimal.html"><code>BigDecimal</code></a> is right there?</h3>
<p>Measurements of nearly everything are less precise than we think they are. If you pull out a tape measure and measure something as being 10 feet long, that measurement is only as precise as your eyes, the placement of both ends of the tape, and the markings on the tape itself. It might be within 1/16th of an inch, but it's not going to be <em>exactly</em> 10 feet. Even objects measured and cut by machine are subject to the precision of that machine — they may be within 1/64th of an inch, but they won't be <em>exactly</em> 10 feet, either.</p>
<p>The point is that measurements just need to be close enough. <code>Float64</code> gets us close enough.</p>
<p>The <a href="https://github.com/spider-gazelle/crunits"><code>spider-gazelle/crunits</code></a> shard offers arbitrary precision for measurements. It's also a lot slower and doesn't offer the same compile-time guarantees that this shard does. But if you feel you need arbitrary precision, use <code>crunits</code>.</p>
<details><summary>Comparison to <code>crunits</code></summary>
<p><code>crunits</code> is a Crystal port of the <a href="https://github.com/joshwlewis/unitwise">Ruby <code>unitwise</code> gem</a>.
The Ruby gem is <em>amazing</em>, to be clear, and the Crystal shard appears to support
similar levels of flexibility and extensibility.</p>
<p>The reason I chose not to use it and instead write <code><a href="Measure.html">Measure</a></code> is that <code>Units</code>
handles measurements as <code>BigDecimal</code> for the magnitude and <code>String</code> for the unit
of measure. This has two primary drawbacks.</p>
<p>The first is that, if you use the wrong unit of measure (misspell it, for example), you can't find out until run time. So if you wrote <code>&quot;hours&quot;</code> instead of <code>&quot;hour&quot;</code>, you may not notice until that code is in production. This fits the Ruby perspective well enough, but <code><a href="Measure.html">Measure</a></code> leans on the Crystal type system so you can detect these sorts of bugs much earlier. You can argue that you should see it work before deploying it, but let's be real, we've all screwed this up. We've YOLOed code to prod, written tests that didn't test what we thought we were testing and never saw them fail, etc. We're not perfect. If you haven't, let me know and I'll hire you.</p>
<p>The second is that using <code>BigDecimal</code> and <code>String</code> makes <code>crunits</code> very malleable (you don't have to patch the shard to add units, for example), but it's also significantly slower. <code>BigDecimal</code> allows arbitrary precision, but that precision has a performance cost. If you need this precision, use <code>crunits</code>. <code>String</code>s for units mean every instantiation, arithmetic operation, conversion, etc all involve string parsing. This adds a lot of overhead. On my machine, the benchmarks look like this:</p>
<pre><code class="language-crystal"><span class="t">Instantiation</span>
crunits   <span class="n">4.84</span>k (<span class="n">206.70</span>µs) (± <span class="n">1.50</span><span class="o">%</span>)  <span class="n">908</span>kB<span class="o">/</span>op  <span class="n">245402.46</span>× slower
measure   <span class="n">1.19</span><span class="t">G</span> (  <span class="n">0.84</span>ns) (± <span class="n">1.33</span><span class="o">%</span>)   <span class="n">0.0</span><span class="t">B</span><span class="o">/</span>op            fastest

<span class="t">Arithmetic</span>
crunits   <span class="n">1.44</span><span class="t">M</span> (<span class="n">693.46</span>ns) (± <span class="n">0.58</span><span class="o">%</span>)  <span class="n">1.93</span>kB<span class="o">/</span>op  <span class="n">359.61</span>× slower
measure <span class="n">518.57</span><span class="t">M</span> (  <span class="n">1.93</span>ns) (± <span class="n">3.71</span><span class="o">%</span>)    <span class="n">0.0</span><span class="t">B</span><span class="o">/</span>op         fastest

<span class="t">Conversion</span>
crunits  <span class="n">13.28</span>k ( <span class="n">75.30</span>µs) (± <span class="n">0.71</span><span class="o">%</span>)  <span class="n">290</span>kB<span class="o">/</span>op  <span class="n">78776.24</span>× slower
measure   <span class="n">1.05</span><span class="t">G</span> (  <span class="n">0.96</span>ns) (± <span class="n">1.42</span><span class="o">%</span>)   <span class="n">0.0</span><span class="t">B</span><span class="o">/</span>op           fastest</code></pre>
<p>For some of these, the monotonic clock is overcounting how long it takes to run the block for <code><a href="Measure.html">Measure</a></code> because it doesn't have sufficient precision, so the real difference may be significantly larger. But even so, a factor of 360-245k is pretty huge. Relying on primitive 64-bit floats and enums makes <code><a href="Measure.html">Measure</a></code> significantly faster.</p>
<p>Chances are, instantiating <code>Units::Measurement</code> instances won't be a bottleneck in your application, but it and the heap-memory usage (<code>Units::Measurement</code> allocates almost 1MB of heap per instance) are factors to consider.</p>
</details>
<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>
<ol>
<li>Fork it (<a href="https://github.com/jgaskins/measure/fork">https://github.com/jgaskins/measure/fork</a>)</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create a new Pull Request</li>
</ol>
<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>
<ul>
<li><a href="https://github.com/jgaskins">Jamie Gaskins</a> - creator and maintainer</li>
</ul>
</div>
</body>
</html>
